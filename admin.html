<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin – Manage Articles</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .article { margin: 10px 0; }
    .save-btn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: #333; color: #fff;
      border: none; border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Manage Articles</h1>
  <div id="articles"></div>
  <button class="save-btn" onclick="saveChanges()">Save</button>

  <script>
    let articles = [];
    const repo = "holyfather5000/ToughNews";   // <-- change this
    const filePath = "articles.json";         // path to JSON
    const branch = "main";

    async function loadArticles() {
      const res = await fetch(filePath + '?nocache=' + Date.now());
      articles = await res.json();
      const container = document.getElementById('articles');
      container.innerHTML = '';

      articles.forEach((a, idx) => {
        const div = document.createElement('div');
        div.className = 'article';
        div.innerHTML = `
          <input type="checkbox" ${a.shown ? 'checked' : ''} onchange="toggle(${idx}, this)">
          <a href="${a.link}" target="_blank">${a.title}</a>
        `;
        container.appendChild(div);
      });
    }

    function toggle(i, checkbox) {
      articles[i].shown = checkbox.checked;
    }

    async function saveChanges() {
      // Convert JSON to Base64 for GitHub API
      const content = btoa(unescape(encodeURIComponent(JSON.stringify(articles, null, 2))));

      // Get the file’s SHA
      const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}?ref=${branch}`);
      const data = await res.json();

      // Commit update (requires a GitHub token)
      await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
        method: "PUT",
        headers: {
          "Authorization": "${{ secrets.PAT_TOKEN }}",   // replace with token
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update shown flags from admin",
          content: content,
          sha: data.sha,
          branch: branch
        })
      });

      alert('Changes saved to GitHub!');
    }

    loadArticles();
  </script>
</body>
</html>
